<!doctype html>

<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TMA ‚Ä¢ CPM Optimizer + Rewards</title>
  <style>
    :root{
      --bg:#0f1115; --card:#161a22; --text:#e7eaf3; --muted:#9aa4bc; --accent:#4c8bf5; --ok:#10b981; --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Noto Sans; display:grid; place-items:center;}
    .wrap{width:min(940px,94vw);display:grid;gap:14px}
    .card{background:var(--card); border-radius:20px; padding:18px; box-shadow:0 8px 32px rgba(0,0,0,.35)}
    h1{margin:0 0 6px;font-size:22px}
    p{margin:0 0 10px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
    .col-12{grid-column:span 12}
    .col-6{grid-column:span 6}
    .col-4{grid-column:span 4}
    @media(max-width:760px){.col-6{grid-column:span 12}.col-4{grid-column:span 12}}.kpi{display:flex;align-items:center;justify-content:space-between}
.kpi .label{color:var(--muted);font-size:12px}
.kpi .value{font-variant-numeric:tabular-nums;font-size:34px;font-weight:800;text-shadow:0 0 12px rgba(76,139,245,.6)}
.value.glow{animation:pulse 1s ease-in-out 3}
@keyframes pulse{0%{text-shadow:0 0 12px rgba(76,139,245,.6)}50%{text-shadow:0 0 28px rgba(76,139,245,1)}100%{text-shadow:0 0 12px rgba(76,139,245,.6)}}

.btn{appearance:none;border:0;border-radius:14px;padding:14px 16px;font-size:16px;font-weight:700;cursor:pointer;background:var(--accent);color:#fff;width:100%}
.btn:active{transform:scale(.98)}
.ghost{background:transparent;border:1.5px solid #2a3244}

.row{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
.row .field{grid-column:span 6}
@media(max-width:760px){.row .field{grid-column:span 12}}
label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
select,input[type=range],input[type=number]{width:100%;background:#0c0f14;border:1px solid #222836;color:var(--text);border-radius:12px;padding:10px}
input[type=range]{height:36px}

.tips{font-size:14px;color:var(--muted)}
.tips li{margin:6px 0}
.badge{display:inline-block;margin-left:6px;font-size:12px;background:#0c0f14;border:1px solid #2a3244;color:#cde; padding:2px 8px;border-radius:999px}

.warn{color:var(--warn)}

  </style>
  <!-- GigaPub SDK (replace id as needed) -->
  <script src="https://ad.gigapub.tech/script?id=1731"></script>
</head>
<body>
  <div class="wrap">
    <div class="card col-12">
      <h1>CPM Optimizer + Rewards</h1>
      <p>Rewarded ads ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶Ø‡¶º ‡¶¨‡¶æ‡¶°‡¶º‡¶æ‡¶®‡•§ ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶®‡ßÅ‡¶Æ‡¶æ‡¶®‡¶ø‡¶ï eCPM ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®, ‡¶Ü‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡•§</p>
    </div><div class="grid">
  <div class="card col-4">
    <div class="kpi">
      <div class="label">Total Points</div>
      <div id="kpiPoints" class="value">0</div>
    </div>
  </div>
  <div class="card col-4">
    <div class="kpi">
      <div class="label">Ads Watched</div>
      <div id="kpiAds" class="value">0</div>
    </div>
  </div>
  <div class="card col-4">
    <div class="kpi">
      <div class="label">Estimated eCPM (USD)</div>
      <div id="kpiEcpm" class="value">0.00</div>
    </div>
  </div>
</div>

<div class="card col-12">
  <div class="row">
    <div class="field">
      <label>Target GEO</label>
      <select id="geo">
        <option value="US">United States</option>
        <option value="GB">United Kingdom</option>
        <option value="DE">Germany</option>
        <option value="CA">Canada</option>
        <option value="AU">Australia</option>
        <option value="BR">Brazil</option>
        <option value="ID">Indonesia</option>
        <option value="PH">Philippines</option>
        <option value="IN">India</option>
        <option value="BD" selected>Bangladesh</option>
        <option value="PK">Pakistan</option>
        <option value="GLOBAL">Global Mix</option>
      </select>
    </div>
    <div class="field">
      <label>Ad Format</label>
      <select id="format">
        <option value="rewarded" selected>Rewarded</option>
        <option value="interstitial">Interstitial</option>
        <option value="banner">Banner</option>
      </select>
    </div>
    <div class="field">
      <label>Completion Rate <span id="crLabel" class="badge">90%</span></label>
      <input id="completion" type="range" min="30" max="100" value="90" />
    </div>
    <div class="field">
      <label>Avg. Session Length (min) <span id="slLabel" class="badge">5</span></label>
      <input id="session" type="range" min="1" max="20" value="5" />
    </div>
    <div class="field">
      <label>Frequency Cap (ads/user/min) <span id="fcLabel" class="badge">1</span></label>
      <input id="freq" type="range" min="1" max="6" value="1" />
    </div>
    <div class="field">
      <label>Reward per Ad (points) <span id="rwLabel" class="badge">10</span></label>
      <input id="reward" type="range" min="1" max="50" value="10" />
    </div>
  </div>
</div>

<div class="grid">
  <div class="card col-6">
    <button id="adsBtn" class="btn" style="background:var(--warn)">üì¢ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
    <p class="tips" id="status">Loading Telegram context‚Ä¶</p>
    <p class="tips warn">‚ö†Ô∏è Auto‚Äëclicking ‡¶®‡¶ø‡¶∑‡¶ø‡¶¶‡ßç‡¶ß‡•§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞-initiated action ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá‡¶á ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®‡•§</p>
  </div>
  <div class="card col-6">
    <p class="tips"><strong>Quick Tips</strong></p>
    <ul class="tips" id="tipsList">
      <li>Rewarded Ads ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ eCPM ‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶¶‡ßá‡¶Ø‡¶º‡•§</li>
      <li>High-value GEO (US/UK/DE/CA/AU) ‡¶è ‡¶´‡ßã‡¶ï‡¶æ‡¶∏ ‡¶ï‡¶∞‡¶≤‡ßá eCPM ‡¶¨‡¶æ‡¶°‡¶º‡ßá‡•§</li>
      <li>Completion rate ‚Üë ‡¶∞‡¶æ‡¶ñ‡¶§‡ßá ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°/‡¶á‡¶®‡¶∏‡ßá‡¶®‡¶ü‡¶ø‡¶≠ ‡¶¶‡¶ø‡¶®‡•§</li>
      <li>Frequency cap 1‚Äì3 ‡¶∞‡ßá‡¶û‡ßç‡¶ú‡ßá ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®; ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶≤‡ßá ad fatigue ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶¶‡ßá‡¶Ø‡¶º‡•§</li>
    </ul>
  </div>
</div>

  </div>  <script>
    // ‚Äî‚Äî Telegram Context ‚Äî‚Äî
    const tg = window.Telegram ? window.Telegram.WebApp : null;

    // ‚Äî‚Äî Elements ‚Äî‚Äî
    const kpiPoints = document.getElementById('kpiPoints');
    const kpiAds = document.getElementById('kpiAds');
    const kpiEcpm = document.getElementById('kpiEcpm');
    const adsBtn = document.getElementById('adsBtn');
    const statusEl = document.getElementById('status');

    const geo = document.getElementById('geo');
    const format = document.getElementById('format');
    const completion = document.getElementById('completion');
    const session = document.getElementById('session');
    const freq = document.getElementById('freq');
    const reward = document.getElementById('reward');

    const crLabel = document.getElementById('crLabel');
    const slLabel = document.getElementById('slLabel');
    const fcLabel = document.getElementById('fcLabel');
    const rwLabel = document.getElementById('rwLabel');

    // ‚Äî‚Äî State ‚Äî‚Äî
    let points = 0;
    let adsWatched = 0;

    // Rough GEO base eCPM (USD) ‚Äî demo only
    const GEO_BASE = { US:10, GB:8, DE:7, CA:7, AU:7, BR:3, ID:2.5, PH:2.5, IN:2, BD:1.5, PK:1.5, GLOBAL:4 };
    const FMT_MUL = { rewarded:1.6, interstitial:1.0, banner:0.3 };

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function estimateEcpm(){
      const base = GEO_BASE[geo.value] || GEO_BASE.GLOBAL;
      const fmt = FMT_MUL[format.value] || 1;
      const cr = Number(completion.value); // 30..100
      const sl = Number(session.value);    // 1..20 (min)
      const fc = Number(freq.value);       // 1..6

      // Completion multiplier: 30% => 0.5x ... 100% => 1.2x
      const crMul = 0.5 + (cr - 30) * (0.7 / 70);
      // Session length: 1min => 0.7x ... 20min => 1.3x
      const slMul = 0.7 + (sl - 1) * (0.6 / 19);
      // Frequency cap penalty after 3+/min
      const fcMul = fc <= 3 ? 1 : clamp(1 - (fc - 3) * 0.15, 0.5, 1);

      const ecpm = base * fmt * crMul * slMul * fcMul;
      return ecpm.toFixed(2);
    }

    function updateKpis(){
      kpiPoints.textContent = points.toString();
      kpiAds.textContent = adsWatched.toString();
      kpiEcpm.textContent = estimateEcpm();
      if (tg){
        tg.MainButton.setText(`Save (${points})`);
        tg.MainButton.show();
      }
    }

    function glow(el){
      el.classList.add('glow');
      setTimeout(()=> el.classList.remove('glow'), 1200);
    }

    // ‚Äî‚Äî Controls Labels & KPI updates ‚Äî‚Äî
    function hookControls(){
      const updateLabels = () => {
        crLabel.textContent = `${completion.value}%`;
        slLabel.textContent = `${session.value}`;
        fcLabel.textContent = `${freq.value}`;
        rwLabel.textContent = `${reward.value}`;
        updateKpis();
        updateTips();
      };
      [geo, format, completion, session, freq, reward].forEach(el=>{
        el.addEventListener('input', updateLabels);
        el.addEventListener('change', updateLabels);
      });
      updateLabels();
    }

    // ‚Äî‚Äî Dynamic tips based on settings ‚Äî‚Äî
    const tipsList = document.getElementById('tipsList');
    function updateTips(){
      const g = geo.value, f = format.value, fc = Number(freq.value), cr = Number(completion.value);
      const tips = [];
      if (['US','GB','DE','CA','AU'].includes(g)) tips.push('High‚Äëvalue GEO ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá ‚Äî eCPM ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶¨‡ßá‡•§');
      else tips.push('Low/Mid GEO ‚Äî global growth ‡¶¨‡¶æ premium ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá eCPM ‡¶¨‡¶æ‡¶°‡¶º‡¶¨‡ßá‡•§');
      if (f !== 'rewarded') tips.push('Rewarded ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶®‡¶ø‡¶≤‡ßá eCPM ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ ‡¶¨‡¶æ‡¶°‡¶º‡ßá‡•§');
      if (cr < 70) tips.push('Completion rate < 70% ‚Äî ‡¶õ‡ßã‡¶ü reward ‡¶¨‡¶æ better placement ‡¶¶‡¶ø‡¶®‡•§');
      if (fc > 3) tips.push('Frequency cap ‡¶¨‡ßá‡¶∂‡¶ø ‚Äî 1‚Äì3 ‡¶è ‡¶Ü‡¶®‡¶≤‡ßá ad fatigue ‡¶ï‡¶Æ‡¶¨‡ßá‡•§');
      if (tips.length === 0) tips.push('‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶¶‡¶æ‡¶∞‡ßÅ‡¶£! ‡¶è‡¶ñ‡¶® ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶´‡¶ø‡¶ï ‡¶∏‡ßç‡¶ï‡ßá‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
      tipsList.innerHTML = tips.map(t=>`<li>${t}</li>`).join('');
    }

    // ‚Äî‚Äî Ad Button ‚Äî‚Äî
    adsBtn.addEventListener('click', () => {
      const rw = Number(reward.value);
      if (typeof window.showGiga === 'function'){
        window.showGiga('main')
          .then(() => {
            points += rw; adsWatched += 1; updateKpis(); glow(kpiPoints); glow(kpiAds);
            if (tg) tg.sendData(JSON.stringify({ action:'ads_reward', reward: rw, total: points, adsWatched }));
            alert(`Reward unlocked! +${rw} points`);
          })
          .catch(e => {
            console.error('GigaPub error:', e);
            alert('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶™‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
          });
      } else {
        // SDK missing ‚Üí fallback
        if (tg) {
          tg.sendData(JSON.stringify({ action:'show_ads' }));
          tg.HapticFeedback?.notificationOccurred('success');
        } else {
          alert('‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá (‡¶°‡ßá‡¶Æ‡ßã ‡¶Æ‡ßã‡¶°)');
        }
      }
    });

    // ‚Äî‚Äî Telegram ready ‚Äî‚Äî
    if (tg){
      try{ tg.expand(); tg.ready(); statusEl.textContent = 'Running inside Telegram Mini App.'; }
      catch(e){ statusEl.textContent = 'Telegram detected, but init failed.'; }
      tg.onEvent?.('mainButtonClicked', ()=> tg.close());
    } else {
      statusEl.textContent = 'Not in Telegram ‚Äî running in a normal browser.';
    }

    hookControls();
    updateKpis();
  </script></body>
</html>
