<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JumpRun ‚Ä¢ AdExtra Rewarded Game (Demo)</title>
  <style>
    :root{
      --bg:#0b1020; --card:#0f1724; --accent:#f59e0b; --text:#e6eef8;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--text); display:flex; min-height:100vh; align-items:center; justify-content:center; padding:20px}
    .wrap{width:100%;max-width:820px}
    .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .card{background:linear-gradient(180deg,#071025 0%, #0b1530 100%); border-radius:12px;padding:12px; box-shadow:0 8px 30px rgba(0,0,0,.6)}
    h1{margin:0;font-size:18px}
    .meta{font-size:13px;color:#9fb1d6}
    canvas{display:block;background:linear-gradient(180deg,#052034,#083047); border-radius:8px; margin-top:10px;}
    .controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    button{background:var(--accent);border:0;padding:10px 12px;border-radius:10px;color:#042; font-weight:700;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,.06); color:var(--text)}
    .hud{display:flex;gap:12px;align-items:center}
    .score-box{background:rgba(255,255,255,.03);padding:8px 12px;border-radius:999px;font-weight:700}
    .center{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:18px}
    .overlay{position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center}
    .modal{background:rgba(7,12,24,.95);padding:18px;border-radius:12px;max-width:480px;text-align:center}
    .muted{color:#9fb1d6;font-size:14px}
    .small{font-size:13px;color:#9fb1d6}
    .green{color:#8ef1b6}
  </style>

  <!-- ==== AdExtra SDK: real URL from AdExtra docs should be used ==== -->
  <!-- Example placeholder (UNCOMMENT & set your id in production): -->
  <!-- <script src="https://adextra.io/sdk.js?app_id=YOUR_APP_ID"></script> -->

</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="card">
          <h1>JumpRun</h1>
          <div class="meta">AdExtra Rewarded Demo Game ‚Äî ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ UI</div>
        </div>
      </div>
      <div class="card hud">
        <div class="score-box">Score: <span id="score">0</span></div>
        <div class="score-box">High: <span id="high">0</span></div>
      </div>
    </div>

    <div style="position:relative">
      <div class="card">
        <canvas id="game" width="760" height="360"></canvas>
        <div class="center">
          <div class="muted">‡¶ï‡ßÄ ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®: ‡¶∏‡ßç‡¶™‡ßá‡¶∏/‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶ú‡¶æ‡¶Æ‡ßç‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶¨‡¶æ‡¶ß‡¶æ ‡¶è‡¶°‡¶º‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶§‡¶¶‡ßÇ‡¶∞ ‡¶ö‡¶≤‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§</div>
          <div class="controls">
            <button id="startBtn">Start Game</button>
            <button id="pauseBtn" class="btn-ghost">Pause</button>
            <button id="soundBtn" class="btn-ghost">üîä Sound: ON</button>
            <button id="leaderBtn" class="btn-ghost">Leaderboard</button>
          </div>
        </div>
      </div>

      <!-- overlay modal area -->
      <div id="overlay" class="overlay" style="display:none">
        <div class="modal">
          <h3 id="modalTitle">Game Over</h3>
          <p id="modalMsg" class="small muted">Your score: <span id="modalScore">0</span></p>
          <div style="height:12px"></div>
          <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
            <button id="reviveBtn">üì∫ Watch Ad to Continue</button>
            <button id="retryBtn" class="btn-ghost">Retry</button>
            <button id="closeBtn" class="btn-ghost">Close</button>
          </div>
          <p style="height:10px"></p>
          <p class="small muted">Note: only testing mode will simulate ad if SDK not available.</p>
        </div>
      </div>
    </div>

    <div style="height:12px"></div>
    <div style="display:flex;justify-content:space-between;gap:12px;align-items:center">
      <div class="card small" style="padding:10px">Ads Watched: <span id="adsWatched">0</span></div>
      <div class="card small" style="padding:10px">Balance: <span id="balance">0.00</span> ‡ß≥</div>
    </div>
  </div>

  <script>
  /***************
   * JumpRun Game *
   * Simple runner: jump to avoid obstacles
   * Integrates AdExtra rewarded flow (checks for window.showAdExtra)
   * Fallback: demo simulated ad if SDK missing
   ***************/

  // ----- game variables -----
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const soundBtn = document.getElementById('soundBtn');
  const leaderBtn = document.getElementById('leaderBtn');

  const overlay = document.getElementById('overlay');
  const reviveBtn = document.getElementById('reviveBtn');
  const retryBtn = document.getElementById('retryBtn');
  const closeBtn = document.getElementById('closeBtn');

  const scoreEl = document.getElementById('score');
  const highEl = document.getElementById('high');
  const modalScore = document.getElementById('modalScore');
  const adsWatchedEl = document.getElementById('adsWatched');
  const balanceEl = document.getElementById('balance');

  // persistent state
  let high = Number(localStorage.getItem('jr_high') || 0);
  let totalAds = Number(localStorage.getItem('jr_ads') || 0);
  let balance = Number(localStorage.getItem('jr_bal') || 0);

  highEl.innerText = high;
  adsWatchedEl.innerText = totalAds;
  balanceEl.innerText = balance.toFixed(2);

  // game state
  let running = false, paused = false;
  let score = 0;
  let speed = 2.2;
  let gravity = 0.7;
  let player = { x:60, y:260, vy:0, w:32, h:32, onGround:true };
  let obstacles = [];
  let spawnTimer = 0;
  let gameOver = false;
  let soundOn = true;

  // simple sounds (optional)
  const beep = new (window.AudioContext || window.webkitAudioContext)();

  function sfx(freq, dur=0.06){ if(!soundOn) return; try{ const o=beep.createOscillator(); const g=beep.createGain(); o.connect(g); g.connect(beep.destination); o.type='sine'; o.frequency.value=freq; g.gain.value=0.05; o.start(); g.gain.exponentialRampToValueAtTime(0.0001, beep.currentTime + dur); o.stop(beep.currentTime + dur); } catch(e){} }

  // controls
  window.addEventListener('keydown', (e)=>{ if(e.code==='Space') jump(); if(e.code==='KeyP') togglePause(); });
  canvas.addEventListener('mousedown', jump);
  startBtn.addEventListener('click', startGame);
  pauseBtn.addEventListener('click', togglePause);
  soundBtn.addEventListener('click', ()=>{ soundOn = !soundOn; soundBtn.innerText = soundOn ? 'üîä Sound: ON' : 'üîá Sound: OFF'; });
  retryBtn.addEventListener('click', ()=>{ overlay.style.display='none'; startGame(); });
  closeBtn.addEventListener('click', ()=>{ overlay.style.display='none'; });
  leaderBtn.addEventListener('click', ()=>{ alert('Leaderboard (demo)\\nHighscore: '+high); });

  reviveBtn.addEventListener('click', ()=>{ 
    // disable to avoid multi-clicks
    reviveBtn.disabled = true; reviveBtn.innerText = 'Loading ad...';
    showRewardedAd()
      .then(success => {
        reviveBtn.disabled = false; reviveBtn.innerText = 'üì∫ Watch Ad to Continue';
        if(success){
          // reward: continue game, small balance add
          stateAfterAd(true);
        } else {
          alert('Ad failed or canceled.');
        }
      })
      .catch(err=>{
        reviveBtn.disabled = false; reviveBtn.innerText = 'üì∫ Watch Ad to Continue';
        console.error(err); alert('Ad error: '+err);
      });
  });

  // ----- core game functions -----
  function startGame(){
    // reset
    score = 0; speed = 2.2; obstacles=[]; spawnTimer=0; gameOver=false;
    player.y = 260; player.vy = 0; player.onGround = true;
    running = true; paused = false;
    startBtn.innerText = 'Restart';
    requestAnimationFrame(loop);
  }

  function togglePause(){ paused = !paused; pauseBtn.innerText = paused ? 'Resume' : 'Pause'; if(!paused) requestAnimationFrame(loop); }

  function jump(){
    if(!running || paused || gameOver) return;
    if(player.onGround){
      player.vy = -10.5; player.onGround = false;
      sfx(520,0.06);
    }
  }

  function spawnObstacle(){
    // obstacle sizes random
    const h = 24 + Math.random()*28;
    obstacles.push({ x:canvas.width + 20, y: 320 - h, w: 18 + Math.random()*20, h: h });
  }

  function update(dt){
    if(paused || gameOver) return;
    // update player
    player.vy += gravity;
    player.y += player.vy;
    if(player.y >= 260){ player.y = 260; player.vy = 0; player.onGround = true; }

    // update obstacles
    for(let i=obstacles.length-1;i>=0;i--){
      obstacles[i].x -= speed;
      if(obstacles[i].x + obstacles[i].w < -10) obstacles.splice(i,1), score += 1, sfx(880,0.03);
    }

    // spawn logic
    spawnTimer -= dt;
    if(spawnTimer <= 0){
      spawnObstacle();
      spawnTimer = 900 + Math.random()*1200 - Math.min(score*10,700); // more score => faster spawn
    }

    // collision check
    for(const o of obstacles){
      if(rectIntersect(player.x, player.y, player.w, player.h, o.x, o.y, o.w, o.h)){
        // hit
        gameOver = true; running = false;
        onGameOver();
        return;
      }
    }

    // speed scaling
    speed = 2.2 + Math.min(score*0.03, 4.5);

    // update scoreboard display
    scoreEl.innerText = score;
    if(score > high){ high = score; localStorage.setItem('jr_high', high); highEl.innerText = high; }
  }

  function rectIntersect(x1,y1,w1,h1,x2,y2,w2,h2){
    return !(x2 > x1 + w1 || x2 + w2 < x1 || y2 > y1 + h1 || y2 + h2 < y1);
  }

  function draw(){
    // clear
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // ground
    ctx.fillStyle = '#063244';
    ctx.fillRect(0,320,canvas.width,40);

    // player
    ctx.fillStyle = '#f59e0b';
    ctx.fillRect(player.x, player.y, player.w, player.h);

    // obstacles
    ctx.fillStyle = '#e86e6e';
    for(const o of obstacles) ctx.fillRect(o.x, o.y, o.w, o.h);

    // score text
    ctx.fillStyle = '#bfe7ff';
    ctx.font = '18px Arial';
    ctx.fillText('Score: '+score, 12, 26);
  }

  let lastTime = performance.now();
  function loop(now){
    if(!running) return;
    const dt = now - lastTime; lastTime = now;
    update(dt);
    draw();
    if(!gameOver) requestAnimationFrame(loop);
  }

  function onGameOver(){
    sfx(150,0.12);
    modalScore.innerText = score;
    overlay.style.display = 'flex';
    // show retry & revive options
    reviveBtn.disabled = false;
  }

  // ----- Ad integration -----
  // This function attempts to show a rewarded ad via AdExtra.
  // Replace 'showAdExtra' name with the real function provided by AdExtra SDK if different.
  function showRewardedAd(){
    return new Promise((resolve, reject) => {
      // First: check if AdExtra provides a function
      if(typeof window.showAdExtra === 'function'){
        // assume signature: window.showAdExtra('rewarded').then(...).catch(...)
        try{
          window.showAdExtra('rewarded').then(()=>{
            resolve(true);
          }).catch(err=>{
            resolve(false);
          });
        } catch(err){
          resolve(false);
        }
        return;
      }

      // fallback: some platforms may use a different name (e.g., showGiga)
      if(typeof window.showGiga === 'function'){
        try{
          window.showGiga('main').then(()=>resolve(true)).catch(()=>resolve(false));
        } catch(e){ resolve(false); }
        return;
      }

      // --- No real SDK found: run a Demo simulated ad (FOR DEV ONLY) ---
      // This block will simulate an ad experience (3s) and then succeed.
      // IMPORTANT: remove this simulation in production.
      console.warn('Ad SDK not found ‚Äî running simulated ad (DEV ONLY). Remove in production.');
      const simulate = confirm('Ad SDK not found. Run simulated ad? (This is DEV only)");
      if(!simulate){ resolve(false); return; }
      // visual: simple timer then resolve true
      let elapsed = 0;
      reviveBtn.innerText = 'Simulating ad... 3';
      const t = setInterval(()=>{
        elapsed++;
        reviveBtn.innerText = 'Simulating ad... ' + (3 - elapsed);
        if(elapsed >= 3){
          clearInterval(t);
          reviveBtn.innerText = 'üì∫ Watch Ad to Continue';
          resolve(true); // treat as watched
        }
      }, 1000);
    });
  }

  // After ad success ‚Äî reward logic (revive + small balance increase)
  function stateAfterAd(success){
    if(!success) return;
    // reward: continue the game ‚Äî small boost and clear a few obstacles
    // close overlay and continue: remove some obstacles and resume
    overlay.style.display = 'none';
    // remove nearest obstacles
    obstacles = obstacles.slice(0, Math.max(0, obstacles.length - 2));
    // small balance payout
    balance += 5.00; // 5 ‡ß≥ for demonstration, set as needed
    adsWatchedUpdate(1);
    persistState();
    balanceEl.innerText = balance.toFixed(2);
    // resume
    gameOver = false; running = true; paused = false; lastTime = performance.now();
    requestAnimationFrame(loop);
  }

  // ----- persistence & utils -----
  function adsWatchedUpdate(delta){
    totalAds += delta; localStorage.setItem('jr_ads', totalAds); adsWatchedEl.innerText = totalAds;
  }
  function persistState(){ localStorage.setItem('jr_bal', balance); localStorage.setItem('jr_high', high); }

  // initial draw
  draw();

  // ----- simple auto-start for demo -----
  // auto-start disabled ‚Äî user should press Start

  // ----- small safety: prevent self-click automation advice -----
  // NOTE: This app intentionally does NOT provide any auto-click/self-click to manipulate real ads.
  // Remove the simulated ad in production and use the real AdExtra SDK calls only.

  </script>
</body>
</html>
